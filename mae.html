<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8" />
<title>Mãe - Entradas por Dia</title>
<style>
body{
  margin:0; padding:20px; font-family:'Helvetica',sans-serif;
  background: linear-gradient(270deg,#9c27b0,#e91e63,#f48fb1);
  background-size:600% 600%;
  animation: gradientBG 15s ease infinite;
  overflow-x:hidden;
}
@keyframes gradientBG{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
h1{text-align:center;color:white;font-size:2.2em;text-shadow:0 2px 6px rgba(0,0,0,0.3); margin-bottom:30px;}
.day-section{margin:20px auto; max-width:400px; border-radius:15px; padding:10px; background:rgba(255,255,255,0.1);}
.day-title{color:white; font-weight:bold; font-size:1.5em; margin-bottom:10px; text-shadow:0 1px 3px rgba(0,0,0,0.3); border-bottom:1px solid rgba(255,255,255,0.3); padding-bottom:5px;}
ul{list-style:none; padding:0;}
li{background:#ffffffaa; color:#e91e63; margin:6px 0; padding:12px 15px; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,0.15); transition:0.3s;}
li:hover{transform:scale(1.05);}
.particle{position:absolute; border-radius:50%; background:white; opacity:0.15; pointer-events:none;}
</style>
</head>
<body>

<h1>Quem entrou</h1>
<div id="conteudo"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAZ328N4FCL_rbJmnxYKXsySHwEyeN1OIU",
  authDomain: "entrada-top.firebaseapp.com",
  databaseURL: "https://entrada-top-default-rtdb.firebaseio.com",
  projectId: "entrada-top",
  storageBucket: "entrada-top.firebasestorage.app",
  messagingSenderId: "1047123646784",
  appId: "1:1047123646784:web:bbd2a1006b8e186a0d02a5",
  measurementId: "G-02DT8KGKTW"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const conteudo = document.getElementById('conteudo');

const entradasPorDia = {};

function parseDateBR(dataStr) {
  if (!dataStr) return null;
  const [date, time] = dataStr.split(' ');
  if (!date || !time) return null;
  const [dd, mm, yyyy] = date.split('/');
  const [hh, min, ss] = time.split(':');
  if ([dd, mm, yyyy, hh, min, ss].some(x=>x===undefined || isNaN(Number(x)))) return null;
  return new Date(`${yyyy}-${mm}-${dd}T${hh}:${min}:${ss}`);
}

db.ref("entradas").on("child_added", snapshot=>{
  const entry = snapshot.val();
  console.log('Data raw:', entry.data);

  let dateObj = parseDateBR(entry.data);
  if(!dateObj || isNaN(dateObj.getTime())) dateObj = new Date(entry.data);

  const day = dateObj && !isNaN(dateObj.getTime()) ? dateObj.toLocaleDateString("pt-PT") : "Data Inválida";

  if(!entradasPorDia[day]) entradasPorDia[day]=[];
  entradasPorDia[day].push(entry);
  atualizarUI();
});

function atualizarUI(){
  conteudo.innerHTML="";
  const dias = Object.keys(entradasPorDia).sort((a,b)=>{
    return new Date(b.split('/').reverse().join('-')) - new Date(a.split('/').reverse().join('-'));
  });

  dias.forEach(day=>{
    const section = document.createElement('div');
    section.className="day-section";

    const titulo = document.createElement('div');
    titulo.className="day-title";
    titulo.textContent = day;
    section.appendChild(titulo);

    const ul=document.createElement('ul');
    entradasPorDia[day].forEach(entry=>{
      const hora = entry.data ? entry.data.split(' ')[1] || '' : '';
      const li = document.createElement('li');
      li.textContent=`${entry.nome} — ${hora}`;
      ul.appendChild(li);
    });

    section.appendChild(ul);
    conteudo.appendChild(section);
  });
}

// partículas animadas
const particles=[];
for(let i=0;i<20;i++){
  const p=document.createElement('div');
  p.className='particle';
  p.style.width=p.style.height=10+Math.random()*40+'px';
  p.style.left=Math.random()*window.innerWidth+'px';
  p.style.top=Math.random()*window.innerHeight+'px';
  document.body.appendChild(p);
  particles.push(p);
}
function moveParticles(x,y){
  particles.forEach((p,idx)=>{
    const dx=(x-window.innerWidth/2)*0.02*(idx+1);
    const dy=(y-window.innerHeight/2)*0.02*(idx+1);
    p.style.transform=`translate(${dx}px,${dy}px)`;
  });
}
window.addEventListener('mousemove', e=>moveParticles(e.clientX,e.clientY));
window.addEventListener('touchmove', e=>{
  const t=e.touches[0];
  moveParticles(t.clientX,t.clientY);
},{passive:true});
</script>

</body>
</html>
